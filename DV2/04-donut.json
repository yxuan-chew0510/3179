{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Comparison of education level distribution (2021) between two Malaysian states.",
  "data": {
    "url": "https://raw.githubusercontent.com/yxuan-chew0510/3179/refs/heads/main/DV2/dataset/edu_lfs_merged.csv"
  },
  "width": 700,
  "height": 450,

  "params": [
    {
      "name": "state_select_left",
      "value": "Selangor",
      "bind": {
        "input": "select",
        "options": [
          "Johor","Kedah","Kelantan","Melaka","Negeri Sembilan","Pahang",
          "Penang","Perak","Perlis","Sabah","Sarawak","Selangor",
          "Terengganu","Kuala Lumpur","Putrajaya","Labuan"
        ],
        "name": "Left State: "
      }
    },
    {
      "name": "state_select_right",
      "value": "Kuala Lumpur",
      "bind": {
        "input": "select",
        "options": [
          "Johor","Kedah","Kelantan","Melaka","Negeri Sembilan","Pahang",
          "Penang","Perak","Perlis","Sabah","Sarawak","Selangor",
          "Terengganu","Kuala Lumpur","Putrajaya","Labuan"
        ],
        "name": "Right State: "
      }
    }
  ],

  "hconcat": [
    {
      "width": 300,
      "height": 300,
      "title": {"text": {"expr": "state_select_left + ' (2021)'"}, "anchor": "middle"},
      "transform": [
        {"calculate": "toNumber(datum.year)", "as": "year_num"},
        {"filter": "datum.year_num == 2021"},
        {"calculate": "trim(datum.state)", "as": "state_trim"},
        {"filter": "datum.state_trim == state_select_left"},
        {
          "calculate": "toNumber(datum.percentage) <= 1 ? toNumber(datum.percentage)*100 : toNumber(datum.percentage)",
          "as": "pct"
        },
        {"aggregate": [{"op": "mean", "field": "pct", "as": "mean_pct"}], "groupby": ["education_level"]}
      ],
      "layer": [
        {
          "mark": {"type": "arc", "innerRadius": 70, "outerRadius": 120},
          "encoding": {
            "theta": {"field": "mean_pct","type": "quantitative"},
            "color": {
              "field": "education_level",
              "type": "nominal",
              "scale": {
                "domain": ["No formal education","Primary","Secondary","Tertiary"],
                "range": ["#E0ECF4","#9ECAE1","#3182BD","#08519C"]
              },
              "legend": {"title": "Education Level","orient": "bottom"}
            },
            "tooltip": [
              {"field": "education_level","title": "Level"},
              {"field": "mean_pct","title": "Share (%)","format": ".1f"}
            ]
          }
        },
        {
          "transform": [{"filter": "datum.education_level != 'No formal education'"}],
          "mark": {
            "type": "text",
            "radius": 150,
            "dy": 10,
            "fill": "#08306B",
            "align": "center",
            "interactive": false
          },
          "encoding": {
            "theta": {"field": "mean_pct","type": "quantitative","stack": true},
            "text": {"field": "mean_pct","format": ".1f"},
            "detail": {"field": "education_level"}
          }
        }
      ]
    },

    {
      "width": 300,
      "height": 300,
      "title": {"text": {"expr": "state_select_right + ' (2021)'"}, "anchor": "middle"},
      "transform": [
        {"calculate": "toNumber(datum.year)", "as": "year_num"},
        {"filter": "datum.year_num == 2021"},
        {"calculate": "trim(datum.state)", "as": "state_trim"},
        {"filter": "datum.state_trim == state_select_right"},
        {
          "calculate": "toNumber(datum.percentage) <= 1 ? toNumber(datum.percentage)*100 : toNumber(datum.percentage)",
          "as": "pct"
        },
        {"aggregate": [{"op": "mean","field": "pct","as": "mean_pct"}], "groupby": ["education_level"]}
      ],
      "layer": [
        {
          "mark": {"type": "arc", "innerRadius": 70, "outerRadius": 120},
          "encoding": {
            "theta": {"field": "mean_pct","type": "quantitative"},
            "color": {
              "field": "education_level",
              "type": "nominal",
              "scale": {
                "domain": ["No formal education","Primary","Secondary","Tertiary"],
                "range": ["#E0ECF4","#9ECAE1","#3182BD","#08519C"]
              },
              "legend": {"title": "Education Level","orient": "bottom"}
            },
            "tooltip": [
              {"field": "education_level","title": "Level"},
              {"field": "mean_pct","title": "Share (%)","format": ".1f"}
            ]
          }
        },
        {
          "transform": [{"filter": "datum.education_level != 'No formal education'"}],
          "mark": {
            "type": "text",
            "radius": 150,
            "dy": 10,
            "fill": "#08306B",
            "align": "center",
            "interactive": false
          },
          "encoding": {
            "theta": {"field": "mean_pct","type": "quantitative","stack": true},
            "text": {"field": "mean_pct","format": ".1f"},
            "detail": {"field": "education_level"}
          }
        }
      ]
    }
  ]
}
